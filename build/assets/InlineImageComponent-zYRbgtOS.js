import{a5 as G,r as u,dK as U,dL as Q,ab as Z,j as e,dM as ee,aA as te,aJ as T,a6 as F,ap as X,ao as K,aj as ne,ba as se,al as I,dN as ie,dO as re,dP as oe,aF as ae,b5 as le,b7 as ce,bX as ue,bY as de}from"./vendor-DFfV0FQp.js";import{t as h,u as me,$ as V,L as ge,F as he,a as pe,P as fe,b as xe,T as be,S as we,D as ve,B as je}from"./index-g13ISYvH.js";function ye({defaultSelection:t}){const[l]=G();return u.useEffect(()=>{l.focus(()=>{const r=document.activeElement,g=l.getRootElement();g===null||r!==null&&g.contains(r)||g.focus({preventScroll:!0})},{defaultSelection:t})},[t,l]),null}function Ce(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ee=Ce(function(t){const l=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",t);for(let g=1;g<arguments.length;g++)r.append("v",arguments[g]);throw l.search=r.toString(),Error(`Minified Lexical error #${t}; visit ${l.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)});function q(t){const l=t.transform();return l!==null?new Set([l]):new Set}function $e({initialEditor:t,children:l,initialNodes:r,initialTheme:g,skipCollabChecks:j}){const w=u.useRef(!1),x=u.useContext(U);x==null&&Ee(9);const[y,{getTheme:W}]=x,P=u.useMemo(()=>{const b=g||W()||void 0,S=Q(x,b);if(b!==void 0&&(t._config.theme=b),t._parentEditor=y,r)for(let i of r){let D=null,R=null;if(typeof i!="function"){const p=i;i=p.replace,D=p.with,R=p.withKlass||null}const M=t._nodes.get(i.getType());t._nodes.set(i.getType(),{exportDOM:M?M.exportDOM:void 0,klass:i,replace:D,replaceWithKlass:R,transforms:q(i)})}else{const i=t._nodes=new Map(y._nodes);for(const[D,R]of i)t._nodes.set(D,{exportDOM:R.exportDOM,klass:R.klass,replace:R.replace,replaceWithKlass:R.replaceWithKlass,transforms:q(R.klass)})}return t._config.namespace=y._config.namespace,t._editable=y._editable,[t,S]},[]),{isCollabActive:C,yjsDocMap:$}=Z(),c=j||w.current||$.has(t.getKey());return u.useEffect(()=>{c&&(w.current=!0)},[c]),u.useEffect(()=>y.registerEditableListener(b=>{t.setEditable(b)}),[t,y]),e.jsx(U.Provider,{value:P,children:!C||c?l:null})}function B(t,l,r){return Math.min(Math.max(t,l),r)}const o={east:1,north:8,south:2,west:4};function Se({onResizeStart:t,onResizeEnd:l,buttonRef:r,imageRef:g,maxWidth:j,editor:w,showCaption:x,setShowCaption:y,captionsEnabled:W}){const P=u.useRef(null),C=u.useRef({priority:"",value:"default"}),$=u.useRef({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),c=w.getRootElement(),b=j||(c!==null?c.getBoundingClientRect().width-20:100),S=c!==null?c.getBoundingClientRect().height-20:100,i=100,D=100,R=n=>{const a=n===o.east||n===o.west,s=n===o.north||n===o.south,z=n&o.north&&n&o.west||n&o.south&&n&o.east,v=a?"ew":s?"ns":z?"nwse":"nesw";c!==null&&c.style.setProperty("cursor",`${v}-resize`,"important"),document.body!==null&&(document.body.style.setProperty("cursor",`${v}-resize`,"important"),C.current.value=document.body.style.getPropertyValue("-webkit-user-select"),C.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))},M=()=>{c!==null&&c.style.setProperty("cursor","text"),document.body!==null&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",C.current.value,C.current.priority))},p=(n,a)=>{if(!w.isEditable())return;const s=g.current,z=P.current;if(s!==null&&z!==null){n.preventDefault();const{width:v,height:d}=s.getBoundingClientRect(),m=$.current;m.startWidth=v,m.startHeight=d,m.ratio=v/d,m.currentWidth=v,m.currentHeight=d,m.startX=n.clientX,m.startY=n.clientY,m.isResizing=!0,m.direction=a,R(a),t(),z.classList.add(`${h.imageControlWrapperResizing}`),s.style.height=`${d}px`,s.style.width=`${v}px`,document.addEventListener("pointermove",N),document.addEventListener("pointerup",L)}},N=n=>{const a=g.current,s=$.current,z=s.direction&(o.east|o.west),v=s.direction&(o.south|o.north);if(a!==null&&s.isResizing)if(z&&v){let d=Math.floor(s.startX-n.clientX);d=s.direction&o.east?-d:d;const m=B(s.startWidth+d,i,b),_=m/s.ratio;a.style.width=`${m}px`,a.style.height=`${_}px`,s.currentHeight=_,s.currentWidth=m}else if(v){let d=Math.floor(s.startY-n.clientY);d=s.direction&o.south?-d:d;const m=B(s.startHeight+d,D,S);a.style.height=`${m}px`,s.currentHeight=m}else{let d=Math.floor(s.startX-n.clientX);d=s.direction&o.east?-d:d;const m=B(s.startWidth+d,i,b);a.style.width=`${m}px`,s.currentWidth=m}},L=()=>{const n=g.current,a=$.current,s=P.current;if(n!==null&&s!==null&&a.isResizing){const z=a.currentWidth,v=a.currentHeight;a.startWidth=0,a.startHeight=0,a.ratio=0,a.startX=0,a.startY=0,a.currentWidth=0,a.currentHeight=0,a.isResizing=!1,s.classList.remove(`${h.imageControlWrapperResizing}`),M(),l(z,v),document.removeEventListener("pointermove",N),document.removeEventListener("pointerup",L)}};return e.jsxs("div",{ref:P,children:[!x&&W&&e.jsx("button",{className:`${h.editor.image.captionButton}`||"image-caption-button",ref:r,onClick:()=>{y(!x)},children:"Add Caption"}),e.jsx("div",{className:`${h.editor.image.resizer.base} ${h.editor.image.resizer.n}`,onPointerDown:n=>{p(n,o.north)}}),e.jsx("div",{className:`${h.editor.image.resizer.base} ${h.editor.image.resizer.ne}`,onPointerDown:n=>{p(n,o.north|o.east)}}),e.jsx("div",{className:`${h.editor.image.resizer.base} ${h.editor.image.resizer.e}`,onPointerDown:n=>{p(n,o.east)}}),e.jsx("div",{className:`${h.editor.image.resizer.base} ${h.editor.image.resizer.se}`,onPointerDown:n=>{p(n,o.south|o.east)}}),e.jsx("div",{className:`${h.editor.image.resizer.base} ${h.editor.image.resizer.s}`,onPointerDown:n=>{p(n,o.south)}}),e.jsx("div",{className:`${h.editor.image.resizer.base} ${h.editor.image.resizer.sw}`,onPointerDown:n=>{p(n,o.south|o.west)}}),e.jsx("div",{className:`${h.editor.image.resizer.base} ${h.editor.image.resizer.w}`,onPointerDown:n=>{p(n,o.west)}}),e.jsx("div",{className:`${h.editor.image.resizer.base} ${h.editor.image.resizer.nw}`,onPointerDown:n=>{p(n,o.north|o.west)}})]})}const J=new Set;function Re(t){if(!J.has(t))throw new Promise(l=>{const r=new Image;r.src=t,r.onload=()=>{J.add(t),l(null)}})}function ze({altText:t,className:l,imageRef:r,src:g,width:j,height:w,position:x}){return Re(g),e.jsx("img",{className:`${l} cursor-default`,src:g,alt:t,ref:r,"data-position":x,style:{display:"block",height:w,width:j},draggable:"false"})}function Pe({activeEditor:t,nodeKey:l,onClose:r}){const j=t.getEditorState().read(()=>X(l)),[w,x]=u.useState(j.getAltText()),[y,W]=u.useState(j.getShowCaption()),[P,C]=u.useState(j.getPosition()),$=S=>{W(S.target.checked)},c=S=>{C(S.target.value)},b=()=>{const S={altText:w,position:P,showCaption:y};j&&t.update(()=>{j.update(S)}),r()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:"1em"},children:e.jsx(be,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:x,value:w,"data-test-id":"image-modal-alt-text-input"})}),e.jsxs(we,{style:{marginBottom:"1em",width:"208px"},value:P,label:"Position",name:"position",id:"position-select",onChange:c,children:[e.jsx("option",{value:"left",children:"Left"}),e.jsx("option",{value:"right",children:"Right"}),e.jsx("option",{value:"full",children:"Full Width"})]}),e.jsxs("div",{className:"Input__wrapper",children:[e.jsx("input",{id:"caption",type:"checkbox",checked:y,onChange:$}),e.jsx("label",{htmlFor:"caption",children:"Show Caption"})]}),e.jsx(ve,{children:e.jsx(je,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>b(),children:"Confirm"})})]})}function We({src:t,altText:l,nodeKey:r,width:g,height:j,showCaption:w,caption:x,position:y}){var Y;const[W,P]=me(),C=u.useRef(null),$=u.useRef(null),[c,b,S]=ee(r),[i]=G(),[D,R]=u.useState(null),M=u.useRef(null),[p,N]=u.useState(!1),[L,n]=u.useState(!1),a=te(),s=((Y=i==null?void 0:i._config)==null?void 0:Y.theme)||{},z=u.useCallback(E=>{if(c&&T(F())){E.preventDefault();const f=X(r);V(f)&&f.remove()}return!1},[c,r]),v=u.useCallback(E=>{const k=F(),f=$.current;if(c&&T(k)&&k.getNodes().length===1){if(w)return K(null),E.preventDefault(),x.focus(),!0;if(f!==null&&f!==document.activeElement)return E.preventDefault(),f.focus(),!0}return!1},[x,c,w]),d=u.useCallback(E=>M.current===x||$.current===E.target?(K(null),i.update(()=>{b(!0);const k=i.getRootElement();k!==null&&k.focus()}),!0):!1,[x,i,b]);u.useEffect(()=>{let E=!0;const k=ne(i.registerUpdateListener(({editorState:f})=>{E&&R(f.read(()=>F()))}),i.registerCommand(ce,(f,H)=>(M.current=H,!1),I),i.registerCommand(le,f=>{const H=f;return p?!0:H.target===C.current?(H.shiftKey?b(!c):(S(),b(!0)),!0):!1},I),i.registerCommand(ae,f=>f.target===C.current?(f.preventDefault(),!0):!1,I),i.registerCommand(oe,z,I),i.registerCommand(re,z,I),i.registerCommand(ie,v,I),i.registerCommand(se,d,I));return()=>{E=!1,k()}},[S,i,c,r,z,p,v,d,b]);const m=(E,k)=>{setTimeout(()=>{N(!1)},200),i.update(()=>{const f=X(r);V(f)&&f.setWidthAndHeight(E,k)})},_=()=>{N(!0)},A=a&&c&&T(D)&&!p,O=(c||p)&&a;return e.jsxs(u.Suspense,{fallback:null,children:[e.jsxs(e.Fragment,{children:[e.jsxs("div",{draggable:A,className:`${s.editor.inlineImage.base}`,children:[a&&e.jsx("button",{className:s.editor.inlineImage.editButton.base||"image-edit-button",ref:$,onClick:()=>{P("Update Inline Image",E=>e.jsx(Pe,{activeEditor:i,nodeKey:r,onClose:E}))},children:"Edit"}),e.jsx(ze,{className:O?`${s.editor.inlineImage.img.focused} ${A?`${s.editor.inlineImage.img.draggable.base}`:""}`:null,src:t,altText:l,imageRef:C,width:g,height:j,position:y})]}),w&&e.jsx("div",{className:s.editor.inlineImage.captionContainer||"image-caption-container",children:e.jsxs($e,{initialEditor:x,children:[e.jsx(ye,{}),e.jsx(ge,{}),e.jsx(he,{isLinkEditMode:L,setIsLinkEditMode:n}),e.jsx(pe,{}),e.jsx(ue,{contentEditable:e.jsx(xe,{className:"min-h-[20px] border-[0px] resize-none cursor-text block relative [tab-size:1] outline-[0px] p-[10px] select-text text-[14px] leading-[1.4em] w-[calc(100% - 20px)] whitespace-pre-wrap"}),placeholder:e.jsx(fe,{className:"text-[12px] text-[#888] overflow-hidden absolute overflow-ellipsis bottom-[10px] left-[10px] select-none whitespace-nowrap inline-block pointer-events-none",children:"Enter a caption..."}),ErrorBoundary:de})]})}),T(D)&&O&&e.jsx(Se,{showCaption:w,setShowCaption:()=>{},editor:i,buttonRef:$,imageRef:C,maxWidth:1080,onResizeStart:_,onResizeEnd:m,captionsEnabled:!1})]}),W]})}export{Pe as UpdateInlineImageDialog,We as default};
